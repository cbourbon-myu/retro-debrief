<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ­ Retro Debrief â€” Ã‰diteur de ThÃ¨me</title>
<link rel="icon" type="image/png" href="https://raw.githubusercontent.com/cbourbon-myu/retro-debrief/main/assets/favicon.png?v=2"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'DM Sans', sans-serif; background: #0F0F0F; color: #E5E5E5; min-height: 100vh; }
  .app { display: grid; grid-template-columns: 360px 1fr; height: 100vh; }
  @media (max-width: 900px) { .app { grid-template-columns: 1fr; } .preview-panel { display: none; } }
  .sidebar { background: #161616; border-right: 1px solid #2A2A2A; overflow-y: auto; display: flex; flex-direction: column; }
  .sidebar-header { padding: 20px 18px 12px; border-bottom: 1px solid #2A2A2A; flex-shrink: 0; }
  .sidebar-header h1 { font-size: 18px; font-weight: 800; color: #F97316; letter-spacing: 0.5px; }
  .sidebar-header p { font-size: 11px; color: #666; margin-top: 4px; }
  .tabs { display: flex; flex-wrap: wrap; gap: 2px; padding: 10px 12px; border-bottom: 1px solid #2A2A2A; flex-shrink: 0; }
  .tab { padding: 6px 10px; border-radius: 6px; border: none; background: none; color: #777; font-size: 11px; font-weight: 600; cursor: pointer; font-family: inherit; transition: all 0.15s; white-space: nowrap; }
  .tab:hover { color: #bbb; background: #1E1E1E; }
  .tab.active { color: #F97316; background: #261A0F; }
  .section { padding: 14px 16px; flex: 1; overflow-y: auto; }
  .section-title { font-size: 11px; font-weight: 700; color: #555; text-transform: uppercase; letter-spacing: 1.5px; margin: 16px 0 8px; }
  .section-title:first-child { margin-top: 0; }
  .field { margin-bottom: 10px; }
  .field label { display: block; font-size: 11px; font-weight: 600; color: #888; margin-bottom: 4px; }
  .field input[type="text"], .field input[type="url"], .field textarea, .field select { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid #333; background: #1A1A1A; color: #E5E5E5; font-size: 12px; font-family: inherit; outline: none; transition: border-color 0.15s; }
  .field input:focus, .field textarea:focus, .field select:focus { border-color: #F97316; }
  .field textarea { resize: vertical; min-height: 60px; }
  .field-row { display: flex; gap: 8px; align-items: flex-end; }
  .field-row .field { flex: 1; }
  .color-field { display: flex; align-items: center; gap: 8px; }
  .color-field input[type="color"] { width: 32px; height: 32px; border: 2px solid #333; border-radius: 6px; cursor: pointer; background: none; padding: 0; }
  .color-field input[type="color"]::-webkit-color-swatch { border-radius: 4px; border: none; }
  .color-field input[type="color"]::-webkit-color-swatch-wrapper { padding: 2px; }
  .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; }
  .toggle-label { font-size: 12px; font-weight: 600; color: #aaa; }
  .toggle { width: 40px; height: 22px; border-radius: 12px; border: none; cursor: pointer; position: relative; transition: background 0.2s; }
  .toggle.on { background: #F97316; } .toggle.off { background: #333; }
  .toggle::after { content: ''; position: absolute; width: 16px; height: 16px; border-radius: 50%; background: white; top: 3px; transition: left 0.2s; }
  .toggle.on::after { left: 21px; } .toggle.off::after { left: 3px; }
  .emoji-grid { display: grid; grid-template-columns: auto 1fr 1fr; gap: 6px; align-items: center; margin-bottom: 6px; }
  .emoji-grid .num { font-size: 11px; color: #555; font-weight: 700; text-align: center; width: 18px; }
  .array-item { background: #1A1A1A; border: 1px solid #2A2A2A; border-radius: 10px; padding: 10px 12px; margin-bottom: 8px; }
  .array-item-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
  .array-item-title { font-size: 12px; font-weight: 700; color: #ccc; }
  .btn-remove { background: none; border: none; color: #EF4444; cursor: pointer; font-size: 14px; padding: 2px 6px; border-radius: 4px; }
  .btn-remove:hover { background: rgba(239,68,68,0.1); }
  .btn-add { padding: 8px 14px; border-radius: 8px; border: 1px dashed #444; background: none; color: #888; font-size: 12px; cursor: pointer; width: 100%; font-family: inherit; font-weight: 600; transition: all 0.15s; }
  .btn-add:hover { border-color: #F97316; color: #F97316; }
  .outro-block { background: #1A1A1A; border: 1px solid #2A2A2A; border-radius: 10px; padding: 10px 12px; margin-bottom: 8px; }
  .outro-block-title { font-size: 11px; font-weight: 700; color: #F97316; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
  .preview-panel { overflow-y: auto; padding: 24px; background: #0F0F0F; }
  .preview-card { border-radius: 16px; overflow: hidden; margin-bottom: 16px; }
  .btn-bar { padding: 12px 16px; border-top: 1px solid #2A2A2A; display: flex; gap: 8px; flex-shrink: 0; }
  .btn-primary { flex: 1; padding: 10px; border-radius: 10px; border: none; background: linear-gradient(135deg, #F97316, #EA580C); color: white; font-size: 13px; font-weight: 700; cursor: pointer; font-family: inherit; transition: transform 0.1s; }
  .btn-primary:hover { transform: scale(1.02); }
  .btn-secondary { padding: 10px; border-radius: 10px; border: 1px solid #444; background: none; color: #aaa; font-size: 13px; font-weight: 600; cursor: pointer; font-family: inherit; }
  .btn-secondary:hover { border-color: #888; color: #ddd; }
  .btn-danger { padding: 10px; border-radius: 10px; border: 1px solid #7F1D1D; background: none; color: #EF4444; font-size: 13px; font-weight: 600; cursor: pointer; font-family: inherit; }
  .btn-danger:hover { background: #7F1D1D22; }
  .status-bar { padding: 8px 16px; border-top: 1px solid #2A2A2A; font-size: 11px; color: #555; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
  .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; }
  .login-screen { min-height: 100vh; background: #0F0F0F; display: flex; align-items: center; justify-content: center; padding: 16px; }
  .login-card { background: #161616; border: 1px solid #2A2A2A; border-radius: 20px; padding: 40px 32px; max-width: 420px; width: 100%; text-align: center; }
  .base-picker { padding: 12px 16px; border-bottom: 1px solid #2A2A2A; flex-shrink: 0; }
  .base-picker select { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid #333; background: #1A1A1A; color: #ccc; font-size: 12px; font-family: inherit; }
</style>
</head>
<body>
<div id="root"></div>
<script>
  var ADMIN_EMAILS = ["c.bourbon@myunisoft.fr", "m.gonzalez@myunisoft.fr"];
  var firebaseConfig = { apiKey: "AIzaSyBPH2KoTL5kYXT5c7obYidciDuElmr2C7Y", authDomain: "backstage-debrief.firebaseapp.com", databaseURL: "https://backstage-debrief-default-rtdb.europe-west1.firebasedatabase.app", projectId: "backstage-debrief", storageBucket: "backstage-debrief.firebasestorage.app", messagingSenderId: "313402258283", appId: "1:313402258283:web:5f6ce5828effa0a519d22e" };
  var db = null, auth = null;
  try { firebase.initializeApp(firebaseConfig); db = firebase.database(); auth = firebase.auth(); } catch(e) { console.warn("Firebase:", e); }
  window.RETRO_TEMPLATES = window.RETRO_TEMPLATES || {};
</script>
<script src="templates/backstage.js"></script>
<script src="templates/starwars.js"></script>
<script src="templates/gaming.js"></script>
<script src="templates/retro80.js"></script>
<script src="templates/kohlanta.js"></script>
<script type="text/babel">
const { useState, useEffect, useCallback } = React;

const DEFAULT_TPL = { id:"custom-theme",name:"Mon ThÃ¨me Custom",desc:"Un thÃ¨me personnalisÃ©",preview:"ğŸ¨âœ¨ğŸ­",dark:false,accent:"#F97316",accentDark:"#C2410C",accentLight:"#FFF7ED",bodyBg:"#F8EBDB",cardBg:"#FFFAF5",cardBorder:"#E8C9A8",inputBg:"#FFFAF5",inputBorder:"#E8C9A8",textPrimary:"#1F2937",textSecondary:"#6B7280",textMuted:"#9CA3AF",progressBg:"#FED7AA",appTitle:"MON THÃˆME",subtitle:"RÃ©tro Sprint â€” MyUnisoft GI",headerImage:"none",headerGradient:"linear-gradient(135deg, rgba(28,10,10,0.85) 0%, rgba(59,15,15,0.80) 40%, rgba(120,30,20,0.45) 100%)",rulesTitle:"ğŸ¼",rulesName:"RÃ¨gles du Pitt",rulesColor:"#78350F",rulesDotColor:"#F97316",rulesImage:"none",rulesOverlayMobile:"linear-gradient(to bottom, #FFF6EE 0%, #FFF6EE 50%, rgba(255,246,238,0.7) 70%, rgba(255,246,238,0.3) 100%)",rulesOverlayDesktop:"linear-gradient(to right, #FFF6EE 0%, #FFF6EE 40%, rgba(255,246,238,0.7) 60%, rgba(255,246,238,0.2) 80%, transparent 100%)",rulesItems:["Ce qui se dit en rÃ©tro reste en rÃ©tro","Pas de jugement, que du feedback constructif","Tout le monde parle, personne ne domine","On cherche des solutions, pas des coupables","Les dÃ©cisions se prennent ensemble"],tooltip:{title:"LES RÃˆGLES DU GI CLUB",quote:"LA PREMIÃˆRE RÃˆGLE DU GI CLUB EST :\nON NE PARLE PAS DU GI CLUB EN DEHORS DU GI CLUB",author:"â€” Tyler Durden, probablement PO dans une autre vie"},categories:[{id:"rock",label:"Rock"},{id:"fausse",label:"Fausse note"},{id:"ameliorer",label:"AmÃ©liorer"}],columns:{rock:{title:"ğŸ¸ Rock",color:"#15803D",border:"#BBF7D0"},fausse:{title:"ğŸµ Fausse Note",color:"#DC2626",border:"#FECACA"},ameliorer:{title:"ğŸ”§ AmÃ©liorer",color:"#2563EB",border:"#BFDBFE"}},vibeTitle:"ğŸ¤ Vibe Check",vibeChecks:[{id:"ambiance",label:"Ambiance du Sprint",color:"#B45309",bg:"#FEF3C7",border:"#F59E0B",image:"",imageStyle:null},{id:"satisfaction",label:"Satisfaction Travail",color:"#7C3AED",bg:"#EDE9FE",border:"#8B5CF6",image:"",imageStyle:null}],roti:{id:"roti",label:"ROTI",color:"#C2410C",bg:"#FFEDD5",border:"#EA580C",image:"",imageStyle:null},ratingLabels:{1:{emoji:"ğŸ˜¤",label:"Catastrophe"},2:{emoji:"ğŸ˜•",label:"Pas top"},3:{emoji:"ğŸ˜",label:"Moyen"},4:{emoji:"ğŸ˜Š",label:"Bien"},5:{emoji:"ğŸ¤©",label:"Excellent"}},ratingCatLabels:{ambiance:"Ambiance du Sprint",satisfaction:"Satisfaction Travail",roti:"ROTI"},feedbackTitle:"ğŸ’¬ Feedbacks",actionTitle:"ğŸ¯ Actions",actionQuote:"\"L'action est la clÃ© du succÃ¨s.\"",afterTitle:"ğŸ“Š RÃ©sultats & Actions",summaryTitle:"ğŸ† RÃ©sumÃ© de la RÃ©tro",summaryImage:"none",summaryOverlay:"linear-gradient(135deg, rgba(28,10,10,0.88) 0%, rgba(50,14,14,0.92) 50%, rgba(28,10,10,0.88) 100%)",summaryPinHint:"Les retours ğŸ“Œ Ã©pinglÃ©s par l'admin apparaÃ®tront ici.",outroTitle:"ğŸ¬ Le Mot de la Fin",outro:{none:{text:"En attente des votes...",emoji:"â³"},low:{text:"Message basse moyenne",emoji:"ğŸ˜¬"},mid:{text:"Message moyenne correcte",emoji:"ğŸ‘"},high:{text:"Message haute moyenne",emoji:"ğŸ‰"}},outroGifs:{none:"",low:"",mid:"",high:""},mdTitle:"ğŸ¤ RÃ©tro Sprint",mdSummary:"ğŸ“Š RÃ©sumÃ©",mdGlobal:"ğŸ¯ Moyenne globale",mdPinned:"ğŸ“Œ Retours Ã©pinglÃ©s",mdActions:"ğŸ¯ Actions",mdDetail:"ğŸ“‹ DÃ©tail des retours"};

// === FORM COMPONENTS ===
function CF({label,value,onChange}){return(<div className="field"><label>{label}</label><div className="color-field"><input type="color" value={value?.startsWith("#")?value:"#000000"} onChange={e=>onChange(e.target.value)}/><input type="text" value={value||""} onChange={e=>onChange(e.target.value)} placeholder="#RRGGBB"/></div></div>);}
function TF({label,value,onChange,placeholder,multiline}){return(<div className="field"><label>{label}</label>{multiline?<textarea value={value||""} onChange={e=>onChange(e.target.value)} placeholder={placeholder}/>:<input type="text" value={value||""} onChange={e=>onChange(e.target.value)} placeholder={placeholder}/>}</div>);}
function UF({label,value,onChange}){return(<div className="field"><label>{label}</label><input type="url" value={value||""} onChange={e=>onChange(e.target.value)} placeholder="https://... ou 'none'"/></div>);}

// === TABS ===
function TabIdentite({t,set}){return(<><div className="section-title">IdentitÃ©</div><TF label="ID unique" value={t.id} onChange={v=>set("id",v.toLowerCase().replace(/[^a-z0-9-]/g,""))}/><TF label="Nom" value={t.name} onChange={v=>set("name",v)}/><TF label="Description" value={t.desc} onChange={v=>set("desc",v)}/><TF label="Emojis aperÃ§u" value={t.preview} onChange={v=>set("preview",v)}/><div className="toggle-row"><span className="toggle-label">Mode sombre</span><button className={`toggle ${t.dark?"on":"off"}`} onClick={()=>set("dark",!t.dark)}/></div></>);}

function TabCouleurs({t,set}){return(<><div className="section-title">Principales</div><CF label="Accent" value={t.accent} onChange={v=>set("accent",v)}/><CF label="Accent foncÃ©" value={t.accentDark} onChange={v=>set("accentDark",v)}/><CF label="Accent clair" value={t.accentLight} onChange={v=>set("accentLight",v)}/><div className="section-title">ArriÃ¨re-plans</div><CF label="Body" value={t.bodyBg} onChange={v=>set("bodyBg",v)}/><CF label="Cartes" value={t.cardBg} onChange={v=>set("cardBg",v)}/><CF label="Bordures" value={t.cardBorder} onChange={v=>set("cardBorder",v)}/><CF label="Inputs" value={t.inputBg} onChange={v=>set("inputBg",v)}/><CF label="Inputs bord." value={t.inputBorder} onChange={v=>set("inputBorder",v)}/><CF label="Progress" value={t.progressBg} onChange={v=>set("progressBg",v)}/><div className="section-title">Textes</div><CF label="Primaire" value={t.textPrimary} onChange={v=>set("textPrimary",v)}/><CF label="Secondaire" value={t.textSecondary} onChange={v=>set("textSecondary",v)}/><CF label="AttÃ©nuÃ©" value={t.textMuted} onChange={v=>set("textMuted",v)}/></>);}

function TabHeader({t,set}){return(<><div className="section-title">Header</div><TF label="Titre" value={t.appTitle} onChange={v=>set("appTitle",v)}/><TF label="Sous-titre" value={t.subtitle} onChange={v=>set("subtitle",v)}/><UF label="Image fond" value={t.headerImage} onChange={v=>set("headerImage",v)}/><TF label="Gradient" value={t.headerGradient} onChange={v=>set("headerGradient",v)} multiline/></>);}

function TabRegles({t,set}){const sT=(k,v)=>set("tooltip",{...t.tooltip,[k]:v});const uR=(i,v)=>{const a=[...t.rulesItems];a[i]=v;set("rulesItems",a);};return(<><div className="section-title">RÃ¨gles</div><div className="field-row"><TF label="Emoji" value={t.rulesTitle} onChange={v=>set("rulesTitle",v)}/><TF label="Nom" value={t.rulesName} onChange={v=>set("rulesName",v)}/></div><CF label="Couleur titre" value={t.rulesColor} onChange={v=>set("rulesColor",v)}/><CF label="Puces" value={t.rulesDotColor} onChange={v=>set("rulesDotColor",v)}/><UF label="Image fond" value={t.rulesImage} onChange={v=>set("rulesImage",v)}/><TF label="Overlay mobile" value={t.rulesOverlayMobile} onChange={v=>set("rulesOverlayMobile",v)} multiline/><TF label="Overlay desktop" value={t.rulesOverlayDesktop} onChange={v=>set("rulesOverlayDesktop",v)} multiline/><div className="section-title">RÃ¨gles ({t.rulesItems.length})</div>{t.rulesItems.map((r,i)=>(<div key={i} style={{display:"flex",gap:6,marginBottom:6}}><input type="text" value={r} onChange={e=>uR(i,e.target.value)} style={{flex:1,padding:"6px 10px",borderRadius:6,border:"1px solid #333",background:"#1A1A1A",color:"#E5E5E5",fontSize:12,fontFamily:"inherit"}}/><button className="btn-remove" onClick={()=>set("rulesItems",t.rulesItems.filter((_,j)=>j!==i))}>âœ•</button></div>))}<button className="btn-add" onClick={()=>set("rulesItems",[...t.rulesItems,"Nouvelle rÃ¨gle"])}>+ Ajouter</button><div className="section-title">Tooltip</div><TF label="Titre" value={t.tooltip.title} onChange={v=>sT("title",v)}/><TF label="Citation" value={t.tooltip.quote} onChange={v=>sT("quote",v)} multiline/><TF label="Auteur" value={t.tooltip.author} onChange={v=>sT("author",v)}/></>);}

function TabColonnes({t,set}){const uC=(i,k,v)=>{const c=[...t.categories];c[i]={...c[i],[k]:v};set("categories",c);};const uCol=(id,k,v)=>set("columns",{...t.columns,[id]:{...t.columns[id],[k]:v}});return(<><div className="section-title">Colonnes ({t.categories.length})</div>{t.categories.map((cat,i)=>(<div key={i} className="array-item"><div className="array-item-header"><span className="array-item-title">{cat.id}</span>{t.categories.length>2&&<button className="btn-remove" onClick={()=>{const c={...t.columns};delete c[cat.id];set("categories",t.categories.filter((_,j)=>j!==i));set("columns",c);}}>âœ•</button>}</div><div className="field-row"><TF label="ID" value={cat.id} onChange={v=>{const old=cat.id;const c={...t.columns};c[v]=c[old];delete c[old];uC(i,"id",v);set("columns",c);}}/><TF label="Label" value={cat.label} onChange={v=>uC(i,"label",v)}/></div><TF label="Titre" value={t.columns[cat.id]?.title||""} onChange={v=>uCol(cat.id,"title",v)}/><div className="field-row"><CF label="Couleur" value={t.columns[cat.id]?.color} onChange={v=>uCol(cat.id,"color",v)}/><CF label="Bordure" value={t.columns[cat.id]?.border} onChange={v=>uCol(cat.id,"border",v)}/></div></div>))}{t.categories.length<5&&<button className="btn-add" onClick={()=>{const id="cat"+(t.categories.length+1);set("categories",[...t.categories,{id,label:"Nouveau"}]);set("columns",{...t.columns,[id]:{title:"ğŸ†• Nouveau",color:"#6B7280",border:"#E5E7EB"}});}}>+ Ajouter</button>}</>);}

function TabVotes({t,set}){const uV=(i,k,v)=>{const vs=[...t.vibeChecks];vs[i]={...vs[i],[k]:v};set("vibeChecks",vs);};const sR=(n,k,v)=>set("ratingLabels",{...t.ratingLabels,[n]:{...t.ratingLabels[n],[k]:v}});return(<><div className="section-title">Vibe Checks</div><TF label="Titre" value={t.vibeTitle} onChange={v=>set("vibeTitle",v)}/>{t.vibeChecks.map((vc,i)=>(<div key={i} className="array-item"><div className="array-item-title" style={{marginBottom:8}}>{vc.id}</div><TF label="Label" value={vc.label} onChange={v=>uV(i,"label",v)}/><div className="field-row"><CF label="Couleur" value={vc.color} onChange={v=>uV(i,"color",v)}/><CF label="Fond" value={vc.bg} onChange={v=>uV(i,"bg",v)}/></div><CF label="Bordure" value={vc.border} onChange={v=>uV(i,"border",v)}/><UF label="Image" value={vc.image} onChange={v=>uV(i,"image",v)}/></div>))}<div className="section-title">ROTI</div><div className="array-item"><TF label="Label" value={t.roti.label} onChange={v=>set("roti",{...t.roti,label:v})}/><div className="field-row"><CF label="Couleur" value={t.roti.color} onChange={v=>set("roti",{...t.roti,color:v})}/><CF label="Fond" value={t.roti.bg} onChange={v=>set("roti",{...t.roti,bg:v})}/></div><CF label="Bordure" value={t.roti.border} onChange={v=>set("roti",{...t.roti,border:v})}/><UF label="Image" value={t.roti.image} onChange={v=>set("roti",{...t.roti,image:v})}/></div><div className="section-title">Labels (1-5)</div>{[1,2,3,4,5].map(n=>(<div key={n} className="emoji-grid"><span className="num">{n}</span><input type="text" value={t.ratingLabels[n]?.emoji||""} onChange={e=>sR(n,"emoji",e.target.value)} style={{padding:"6px 8px",borderRadius:6,border:"1px solid #333",background:"#1A1A1A",color:"#E5E5E5",fontSize:14,fontFamily:"inherit",textAlign:"center"}}/><input type="text" value={t.ratingLabels[n]?.label||""} onChange={e=>sR(n,"label",e.target.value)} style={{padding:"6px 8px",borderRadius:6,border:"1px solid #333",background:"#1A1A1A",color:"#E5E5E5",fontSize:12,fontFamily:"inherit"}}/></div>))}</>);}

function TabActions({t,set}){return(<><div className="section-title">Feedbacks & Actions</div><TF label="Titre feedbacks" value={t.feedbackTitle} onChange={v=>set("feedbackTitle",v)}/><TF label="Section rÃ©sultats" value={t.afterTitle} onChange={v=>set("afterTitle",v)}/><TF label="Titre actions" value={t.actionTitle} onChange={v=>set("actionTitle",v)}/><TF label="Citation" value={t.actionQuote} onChange={v=>set("actionQuote",v)} multiline/><div className="section-title">RÃ©sumÃ©</div><TF label="Titre" value={t.summaryTitle} onChange={v=>set("summaryTitle",v)}/><UF label="Image fond" value={t.summaryImage} onChange={v=>set("summaryImage",v)}/><TF label="Overlay" value={t.summaryOverlay} onChange={v=>set("summaryOverlay",v)} multiline/><TF label="Hint Ã©pingles" value={t.summaryPinHint} onChange={v=>set("summaryPinHint",v)}/></>);}

function TabOutro({t,set}){const sO=(k,f,v)=>set("outro",{...t.outro,[k]:{...t.outro[k],[f]:v}});const sG=(k,v)=>set("outroGifs",{...t.outroGifs,[k]:v});const keys=[{key:"none",label:"â³ En attente",color:"#6B7280"},{key:"low",label:"ğŸ˜¬ Basse",color:"#EF4444"},{key:"mid",label:"ğŸ‘ Moyenne",color:"#F59E0B"},{key:"high",label:"ğŸ‰ Haute",color:"#10B981"}];return(<><div className="section-title">Outro</div><TF label="Titre" value={t.outroTitle} onChange={v=>set("outroTitle",v)}/>{keys.map(({key,label,color})=>(<div key={key} className="outro-block"><div className="outro-block-title" style={{color}}>{label}</div><div className="field-row"><div className="field" style={{maxWidth:60}}><label>Emoji</label><input type="text" value={t.outro[key]?.emoji||""} onChange={e=>sO(key,"emoji",e.target.value)} style={{textAlign:"center",fontSize:18,padding:"4px",width:"100%",borderRadius:6,border:"1px solid #333",background:"#1A1A1A",color:"#E5E5E5",fontFamily:"inherit"}}/></div><TF label="Message" value={t.outro[key]?.text||""} onChange={v=>sO(key,"text",v)} multiline/></div><UF label={"GIF ("+key+")"} value={t.outroGifs?.[key]} onChange={v=>sG(key,v)}/></div>))}</>);}

function TabMarkdown({t,set}){return(<><div className="section-title">Labels Markdown</div><TF label="Titre" value={t.mdTitle} onChange={v=>set("mdTitle",v)}/><TF label="RÃ©sumÃ©" value={t.mdSummary} onChange={v=>set("mdSummary",v)}/><TF label="Moyenne" value={t.mdGlobal} onChange={v=>set("mdGlobal",v)}/><TF label="Ã‰pinglÃ©s" value={t.mdPinned} onChange={v=>set("mdPinned",v)}/><TF label="Actions" value={t.mdActions} onChange={v=>set("mdActions",v)}/><TF label="DÃ©tail" value={t.mdDetail} onChange={v=>set("mdDetail",v)}/></>);}

// === PREVIEW ===
function Preview({t}){const bg=s=>s&&s!=="none"?(s.startsWith("url(")?s:`url(${s})`):null;return(<div>
  <div style={{fontSize:11,fontWeight:700,color:"#555",textTransform:"uppercase",letterSpacing:2,marginBottom:16}}>AperÃ§u Live</div>
  <div className="preview-card" style={{position:"relative",minHeight:80,display:"flex",alignItems:"center",padding:"20px 24px"}}>
    {bg(t.headerImage)&&<div style={{position:"absolute",inset:0,backgroundImage:bg(t.headerImage),backgroundSize:"cover",backgroundPosition:"center",opacity:0.45}}/>}
    <div style={{position:"absolute",inset:0,background:t.headerGradient}}/>
    <div style={{position:"relative",zIndex:1}}><div style={{fontSize:22,fontWeight:800,color:t.accent,letterSpacing:2}}>{t.appTitle}</div><div style={{fontSize:11,color:"rgba(255,255,255,0.6)",marginTop:2}}>{t.subtitle}</div></div>
  </div>
  <div style={{display:"grid",gridTemplateColumns:`repeat(${t.categories.length},1fr)`,gap:8,marginBottom:16}}>
    {t.categories.map(cat=>{const col=t.columns[cat.id];return(<div key={cat.id} style={{background:t.cardBg,border:`2px solid ${col?.border||"#ccc"}`,borderRadius:12,padding:12,textAlign:"center"}}><div style={{fontSize:12,fontWeight:700,color:col?.color}}>{col?.title}</div><div style={{fontSize:10,color:t.textSecondary,marginTop:4}}>Feedbacks...</div></div>);})}
  </div>
  <div style={{background:t.cardBg,borderRadius:14,padding:14,marginBottom:16,border:`1px solid ${t.cardBorder}`}}>
    <div style={{fontSize:13,fontWeight:700,color:t.textPrimary,marginBottom:10}}>{t.vibeTitle}</div>
    <div style={{display:"flex",gap:8}}>{t.vibeChecks.map(vc=>(<div key={vc.id} style={{flex:1,borderRadius:10,border:`2px solid ${vc.border}`,padding:10,textAlign:"center",background:t.dark?"rgba(255,255,255,0.05)":"#FFFAF5"}}>
      <div style={{fontSize:11,fontWeight:700,color:t.dark?vc.border:vc.color,marginBottom:6,display:"flex",alignItems:"center",justifyContent:"center",gap:4}}>
        {vc.image&&<div style={{width:22,height:22,borderRadius:"50%",overflow:"hidden",flexShrink:0}}><img src={vc.image} style={{width:"110%",height:"110%",objectFit:"cover",marginTop:"-5%",marginLeft:"-5%"}}/></div>}{vc.label}</div>
      <div style={{display:"flex",justifyContent:"center",gap:4}}>{[1,2,3,4,5].map(n=>(<div key={n} style={{width:28,height:28,borderRadius:"50%",border:`1px solid ${t.inputBorder}`,background:n===4?vc.bg:t.cardBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,transform:n===4?"scale(1.15)":"scale(1)"}}>{t.ratingLabels[n]?.emoji}</div>))}</div>
    </div>))}</div>
  </div>
  <div className="preview-card" style={{position:"relative",padding:16}}>
    {bg(t.rulesImage)&&<div style={{position:"absolute",inset:0,backgroundImage:bg(t.rulesImage),backgroundSize:"cover",opacity:0.3,borderRadius:16}}/>}
    <div style={{position:"absolute",inset:0,background:t.rulesOverlayDesktop,borderRadius:16}}/>
    <div style={{position:"relative",zIndex:1}}><div style={{fontSize:14,fontWeight:700,color:t.rulesColor,marginBottom:8}}><span style={{fontSize:20,marginRight:6}}>{t.rulesTitle}</span>{t.rulesName}</div>
      {t.rulesItems.slice(0,3).map((r,i)=>(<div key={i} style={{display:"flex",gap:8,marginBottom:4,fontSize:11,color:t.textPrimary}}><span style={{color:t.rulesDotColor,fontWeight:800}}>â—</span>{r}</div>))}
      {t.rulesItems.length>3&&<div style={{fontSize:10,color:t.textMuted}}>+{t.rulesItems.length-3} autres...</div>}
    </div>
  </div>
  <div className="preview-card" style={{position:"relative",padding:16,marginTop:16}}>
    <div style={{position:"absolute",inset:0,background:t.summaryOverlay,borderRadius:16}}/>
    <div style={{position:"relative",zIndex:1,textAlign:"center"}}><div style={{fontSize:14,fontWeight:700,color:t.accent,marginBottom:6}}>{t.outroTitle}</div><div style={{fontSize:24,marginBottom:4}}>{t.outro.high?.emoji}</div><div style={{fontSize:12,color:"#fff",fontStyle:"italic"}}>"{t.outro.high?.text}"</div></div>
  </div>
  <div style={{marginTop:16,fontSize:11,fontWeight:700,color:"#555",textTransform:"uppercase",letterSpacing:2,marginBottom:8}}>Palette</div>
  <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>{[t.accent,t.accentDark,t.accentLight,t.bodyBg,t.cardBg,t.textPrimary,t.textSecondary].map((c,i)=>(<div key={i} style={{width:28,height:28,borderRadius:6,background:c,border:"2px solid #333"}} title={c}/>))}</div>
</div>);}

// === MAIN ===
function App(){
  const[user,setUser]=useState(null);const[authLoading,setAuthLoading]=useState(true);const[authError,setAuthError]=useState(null);
  useEffect(()=>{if(!auth){setAuthLoading(false);return;}return auth.onAuthStateChanged(u=>{setUser(u);setAuthLoading(false);});},[]);
  const signIn=async()=>{setAuthError(null);try{const p=new firebase.auth.GoogleAuthProvider();p.setCustomParameters({hd:"myunisoft.fr"});await auth.signInWithPopup(p);}catch(e){setAuthError(e.message);}};
  const isAdmin=user&&ADMIN_EMAILS.includes(user.email);

  const[template,setTemplate]=useState(()=>{try{const s=localStorage.getItem("theme-editor-draft");if(s)return JSON.parse(s);}catch(e){}return{...DEFAULT_TPL};});
  const[activeTab,setActiveTab]=useState("identite");
  const[saveStatus,setSaveStatus]=useState(null);
  const[customIds,setCustomIds]=useState([]);

  useEffect(()=>{if(!db)return;const ref=db.ref("customTemplates");ref.on("value",s=>{const v=s.val();setCustomIds(v?Object.keys(v):[]);});return()=>ref.off("value");},[]);
  useEffect(()=>{const t=setTimeout(()=>localStorage.setItem("theme-editor-draft",JSON.stringify(template)),500);return()=>clearTimeout(t);},[template]);

  const set=useCallback((k,v)=>setTemplate(p=>({...p,[k]:v})),[]);

  const loadBase=(id)=>{
    if(id==="__blank"){setTemplate({...DEFAULT_TPL});return;}
    const tpl=window.RETRO_TEMPLATES?.[id];
    if(tpl){const c=JSON.parse(JSON.stringify(tpl));c.id=c.id+"-custom";c.name=c.name+" (Custom)";delete c._custom;setTemplate({...DEFAULT_TPL,...c});return;}
    if(db)db.ref("customTemplates/"+id).once("value",s=>{if(s.val())setTemplate({...DEFAULT_TPL,...JSON.parse(JSON.stringify(s.val()))});});
  };

  const saveToFirebase=async()=>{if(!db||!template.id)return;setSaveStatus("saving");try{const d={...template};delete d._custom;await db.ref("customTemplates/"+template.id).set(d);setSaveStatus("saved");setTimeout(()=>setSaveStatus(null),3000);}catch(e){setSaveStatus("error");alert("Erreur : "+e.message);setTimeout(()=>setSaveStatus(null),3000);}};
  const deleteFromFirebase=async()=>{if(!db||!customIds.includes(template.id))return;if(!confirm("Supprimer \""+template.name+"\" de l'app ?"))return;try{await db.ref("customTemplates/"+template.id).set(null);alert("SupprimÃ© !");}catch(e){alert("Erreur : "+e.message);}};
  const exportJS=()=>{const js="// "+template.name+"\n(function(){if(!window.RETRO_TEMPLATES)window.RETRO_TEMPLATES={};window.RETRO_TEMPLATES["+JSON.stringify(template.id)+"]="+JSON.stringify(template,null,2)+";})();\n";const b=new Blob([js],{type:"text/javascript"});const a=document.createElement("a");a.href=URL.createObjectURL(b);a.download=template.id+".js";a.click();};

  const tabs=[{id:"identite",label:"ğŸ·ï¸ IdentitÃ©"},{id:"couleurs",label:"ğŸ¨ Couleurs"},{id:"header",label:"ğŸ” Header"},{id:"regles",label:"ğŸ“‹ RÃ¨gles"},{id:"colonnes",label:"ğŸ“Š Colonnes"},{id:"votes",label:"ğŸ—³ï¸ Votes"},{id:"actions",label:"ğŸ¯ Actions"},{id:"outro",label:"ğŸ¬ Outro"},{id:"markdown",label:"ğŸ“ Export"}];

  if(authLoading)return<div className="login-screen"><div style={{color:"#666"}}>Chargement...</div></div>;
  if(!user)return<div className="login-screen"><div className="login-card">
    <div style={{fontSize:36,marginBottom:12}}>ğŸ­</div><div style={{fontSize:20,fontWeight:800,color:"#F97316",marginBottom:4}}>Ã‰diteur de ThÃ¨me</div><div style={{fontSize:12,color:"#666",marginBottom:24}}>Connecte-toi pour crÃ©er des thÃ¨mes.</div>
    <button onClick={signIn} disabled={authLoading} style={{padding:"12px 32px",borderRadius:10,border:"1px solid #333",background:"#1A1A1A",color:"#E5E5E5",fontSize:14,fontWeight:600,cursor:"pointer",fontFamily:"inherit",display:"flex",alignItems:"center",gap:10,margin:"0 auto"}}>
      <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
      {authLoading?"Connexionâ€¦":"Se connecter"}</button>
    <div style={{fontSize:10,color:"#444",marginTop:16}}>RÃ©servÃ© aux admins MyUnisoft GI</div>
    {authError&&<div style={{marginTop:12,fontSize:12,color:"#EF4444",background:"#7F1D1D22",borderRadius:8,padding:"8px 12px"}}>{authError}</div>}
  </div></div>;
  if(!isAdmin)return<div className="login-screen"><div className="login-card"><div style={{fontSize:36,marginBottom:12}}>ğŸ”’</div><div style={{fontSize:16,fontWeight:700,color:"#EF4444",marginBottom:8}}>AccÃ¨s rÃ©servÃ© aux admins</div><div style={{fontSize:12,color:"#666"}}>{user.email}</div><button onClick={()=>auth.signOut()} style={{marginTop:20,padding:"8px 20px",borderRadius:8,border:"1px solid #333",background:"none",color:"#aaa",cursor:"pointer",fontFamily:"inherit"}}>Se dÃ©connecter</button></div></div>;

  const isExisting=customIds.includes(template.id);

  return(<div className="app"><div className="sidebar">
    <div className="sidebar-header"><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><h1>ğŸ­ Ã‰diteur de ThÃ¨me</h1><button onClick={()=>auth.signOut()} style={{background:"none",border:"none",cursor:"pointer",fontSize:11,color:"#555"}} title="Se dÃ©connecter">ğŸ‘‹ {user.displayName?.split(" ")[0]}</button></div><p>CrÃ©e ton template, enregistre-le dans l'app.</p></div>
    <div className="base-picker"><label style={{fontSize:11,fontWeight:600,color:"#888",display:"block",marginBottom:4}}>Partir d'un thÃ¨me existant :</label>
      <select onChange={e=>loadBase(e.target.value)} defaultValue=""><option value="" disabled>â€” Choisir une base â€”</option><option value="__blank">ğŸ†• Template vierge</option>
        <optgroup label="ThÃ¨mes officiels">{Object.values(window.RETRO_TEMPLATES||{}).filter(t=>!t._custom).map(t=><option key={t.id} value={t.id}>{t.preview} {t.name}</option>)}</optgroup>
        {customIds.length>0&&<optgroup label="ThÃ¨mes custom">{customIds.map(id=><option key={id} value={id}>âœ¨ {id}</option>)}</optgroup>}
      </select></div>
    <div className="tabs">{tabs.map(tab=><button key={tab.id} className={`tab ${activeTab===tab.id?"active":""}`} onClick={()=>setActiveTab(tab.id)}>{tab.label}</button>)}</div>
    <div className="section">
      {activeTab==="identite"&&<TabIdentite t={template} set={set}/>}{activeTab==="couleurs"&&<TabCouleurs t={template} set={set}/>}{activeTab==="header"&&<TabHeader t={template} set={set}/>}{activeTab==="regles"&&<TabRegles t={template} set={set}/>}{activeTab==="colonnes"&&<TabColonnes t={template} set={set}/>}{activeTab==="votes"&&<TabVotes t={template} set={set}/>}{activeTab==="actions"&&<TabActions t={template} set={set}/>}{activeTab==="outro"&&<TabOutro t={template} set={set}/>}{activeTab==="markdown"&&<TabMarkdown t={template} set={set}/>}
    </div>
    <div className="status-bar"><span><span className="status-dot" style={{background:saveStatus==="saved"?"#10B981":saveStatus==="saving"?"#F59E0B":saveStatus==="error"?"#EF4444":"#555"}}/>{saveStatus==="saving"?"Enregistrement...":saveStatus==="saved"?"EnregistrÃ© âœ“":saveStatus==="error"?"Erreur":isExisting?"ThÃ¨me existant":"Non enregistrÃ©"}</span><span style={{color:"#444"}}>ID: {template.id}</span></div>
    <div className="btn-bar"><button className="btn-secondary" onClick={exportJS} title="TÃ©lÃ©charger .js">â¬‡ï¸ .js</button>{isExisting&&<button className="btn-danger" onClick={deleteFromFirebase}>ğŸ—‘ï¸</button>}<button className="btn-primary" onClick={saveToFirebase} disabled={saveStatus==="saving"} style={{opacity:saveStatus==="saving"?0.6:1}}>{saveStatus==="saving"?"â³...":isExisting?"ğŸ’¾ Mettre Ã  jour":"ğŸš€ Enregistrer dans l'app"}</button></div>
  </div><div className="preview-panel"><Preview t={template}/></div></div>);
}
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
